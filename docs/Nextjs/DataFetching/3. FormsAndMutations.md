# ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë€?

React QueryëŠ” API í˜¸ì¶œê³¼ ê´€ë ¨ëœ ë°ì´í„°ë¥¼ ìºì‹œí•˜ê³  ê´€ë¦¬í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤. ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” optimistic updates(ë‚™ê´€ì  ì—…ë°ì´íŠ¸)ë¥¼ ì§€ì›í•˜ë©°, ì´ëŠ” ë°ì´í„°ë¥¼ ì„œë²„ë¡œë¶€í„° ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ê¸° ì „ì—ë„ UIë¥¼ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.  
optimistic updatesëŠ” ìš”ì²­ì„ ë³´ë‚´ê¸° ì „ì— UIë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ê¸°ëŠ¥ì´ë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì‚¬ìš©ìê°€ ê²Œì‹œë¬¼ì„ ì¢‹ì•„ìš” í–ˆì„ ë•Œ, UIì—ì„œ ì¦‰ì‹œ ì¢‹ì•„ìš” ìˆ˜ê°€ ì¦ê°€í•˜ë„ë¡ í•  ìˆ˜ ìˆë‹¤. ì´ ë•Œ ì„œë²„ë¡œ ìš”ì²­ì„ ë³´ë‚´ê¸° ì „ì— UIë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ê²ƒì´ ë‚™ê´€ì  ì—…ë°ì´íŠ¸ì´ë‹¤.

ë‚™ê´€ì  ì—…ë°ì´íŠ¸ëŠ” ì‚¬ìš©ì ê²½í—˜ì„ ê°œì„ í•˜ê³ , ì„œë²„ì—ì„œ ì‘ë‹µì„ ë°›ì„ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  ì‚¬ìš©ìì—ê²Œ ë¹ ë¥¸ í”¼ë“œë°±ì„ ì œê³µí•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ìš”ì²­ì´ ì‹¤íŒ¨í•˜ë©´ ì´ì „ ìƒíƒœë¡œ ë˜ëŒë ¤ì•¼ í•˜ë¯€ë¡œ, ì´ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë¡¤ë°± ë¡œì§ì„ í•¨ê»˜ êµ¬í˜„í•´ì•¼ í•œë‹¤. ì´ëŸ¬í•œ ì´ìœ ë¡œ optimistic updatesëŠ” ì¼ë¶€ ìƒí™©ì—ì„œë§Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

# Forms and Mutations (ì–‘ì‹ ë° ë³€ì´)

ì–‘ì‹ì„ ì‚¬ìš©í•˜ë©´ ì›¹ ì‘ìš© í”„ë¡œê·¸ë¨ì—ì„œ ë°ì´í„°ë¥¼ ë§Œë“¤ê³  ì—…ë°ì´íŠ¸í•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Next.jsëŠ” Server Actionsë¥¼ ì‚¬ìš©í•˜ì—¬ ì–‘ì‹ ì œì¶œ ë° ë°ì´í„° ë³€ì´ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê°•ë ¥í•œ ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.

-   ì˜ˆì œ

    -   [ë¡œë”© ë° ì˜¤ë¥˜ ìƒíƒœ ì–‘ì‹](https://github.com/vercel/next.js/tree/canary/examples/next-forms)

## Server Actionsê°€ ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ê°€?

ì„œë²„ ì•¡ì…˜ì„ ì‚¬ìš©í•˜ë©´ ìˆ˜ë™ìœ¼ë¡œ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ìƒì„±í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. ëŒ€ì‹  ì»´í¬ë„ŒíŠ¸ì—ì„œ ì§ì ‘ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ë¹„ë™ê¸° ì„œë²„ í•¨ìˆ˜ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

ğŸ¥ ë” ì•Œì•„ë³´ê¸°: App ë¼ìš°í„°ë¥¼ ì‚¬ìš©í•œ ì–‘ì‹ ë° ë³€ì´ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš© â†’ [YouTube](https://www.youtube.com/watch?v=dDpZfOQBMaU)

ì„œë²„ ì•¡ì…˜ì€ ì„œë²„ êµ¬ì„± ìš”ì†Œì—ì„œ ì •ì˜í•˜ê±°ë‚˜ í´ë¼ì´ì–¸íŠ¸ êµ¬ì„± ìš”ì†Œì—ì„œ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„œë²„ êµ¬ì„± ìš”ì†Œì—ì„œ ì‘ì—…ì„ ì •ì˜í•˜ë©´ JavaScript ì—†ì´ ì–‘ì‹ì´ ì‘ë™í•˜ë¯€ë¡œ ì ì§„ì  í–¥ìƒì„ ì œê³µí•©ë‹ˆë‹¤.

next.config.js íŒŒì¼ì—ì„œ Server Actionsë¥¼ í™œì„±í™”í•˜ì„¸ìš”:

```js
// next.config.js
module.exports = {
    experimental: {
        serverActions: true,
    },
}
```

ìœ ìš©í•œ ì •ë³´:

-   ì„œë²„ êµ¬ì„± ìš”ì†Œì—ì„œ Server Actionsë¥¼ í˜¸ì¶œí•˜ë©´ JavaScript ì—†ì´ ì‘ë™í•©ë‹ˆë‹¤.
-   í´ë¼ì´ì–¸íŠ¸ êµ¬ì„± ìš”ì†Œì—ì„œ Server Actionsë¥¼ í˜¸ì¶œí•˜ë©´ JavaScriptê°€ ì•„ì§ë¡œë“œë˜ì§€ ì•Šì•˜ë‹¤ë©´ ì œì¶œì„ ëŒ€ê¸°ì‹œí‚µë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ ìˆ˜í™”ë¥¼ ìš°ì„ ì‹œí•©ë‹ˆë‹¤.
-   ì„œë²„ ì•¡ì…˜ì€ ì‚¬ìš©ë˜ëŠ” í˜ì´ì§€ ë˜ëŠ” ë ˆì´ì•„ì›ƒì—ì„œ [ì‹¤í–‰ ì‹œê°„](https://nextjs.org/docs/app/building-your-application/rendering/edge-and-nodejs-runtimes)ì„ ìƒì†ë°›ìŠµë‹ˆë‹¤.
-   ì„œë²„ ì•¡ì…˜ì€ ì™„ì „ ì •ì  ê²½ë¡œ(ISRì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì¬ê²€ì¦ í¬í•¨)ì™€ ì‘ë™í•©ë‹ˆë‹¤.

## ìºì‹œëœ ë°ì´í„° ì¬ê²€ì¦

ì„œë²„ ì•¡ì…˜ì€ Next.js ìºì‹± ë° ì¬ê²€ì¦ ì•„í‚¤í…ì²˜ì™€ ê¹Šì´ í†µí•©ë©ë‹ˆë‹¤. ì–‘ì‹ì´ ì œì¶œë˜ë©´ ì„œë²„ ì•¡ì…˜ì€ ìºì‹œëœ ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  ë³€ê²½í•´ì•¼ í•˜ëŠ” ëª¨ë“  ìºì‹œ í‚¤ë¥¼ ì¬ê²€ì¦í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì „í†µì ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì²˜ëŸ¼ ë¼ìš°íŠ¸ ë‹¹ ë‹¨ì¼ ì–‘ì‹ì— ì œí•œë˜ì§€ ì•Šê³  ì„œë²„ ì•¡ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ë¼ìš°íŠ¸ ë‹¹ ì—¬ëŸ¬ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì €ëŠ” ì–‘ì‹ ì œì¶œ ì‹œ ìƒˆë¡œ ê³ ì¹¨í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤. Next.jsëŠ” ë‹¨ì¼ ë„¤íŠ¸ì›Œí¬ ì™•ë³µì—ì„œ ì—…ë°ì´íŠ¸ëœ UIì™€ ìƒˆë¡œ ê³ ì¹¨ëœ ë°ì´í„°ë¥¼ ë™ì‹œì— ë°˜í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì„œë²„ ì „ìš© ì–‘ì‹ ì˜ˆì‹œ:

ì„œë²„ ì „ìš© ì–‘ì‹ì„ ë§Œë“¤ë ¤ë©´ ì„œë²„ êµ¬ì„± ìš”ì†Œì—ì„œ ì„œë²„ ì•¡ì…˜ì„ ì •ì˜í•©ë‹ˆë‹¤. ì‘ì—…ì€ í•¨ìˆ˜ ìƒë‹¨ì— `"use server"` ì§€ì‹œë¬¸ê³¼ í•¨ê»˜ ì¸ë¼ì¸ìœ¼ë¡œ ì •ì˜í•˜ê±°ë‚˜ íŒŒì¼ ìƒë‹¨ì— ì§€ì‹œë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ë³„ë„ë¡œ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```javascript
// app/page.tsx
// TypeScript

export default function Page() {
    async function create(formData: FormData) {
        'use server'
        // ë°ì´í„° ë³€ì´ mutate data
        // ìºì‹œ ì¬ê²€ì¦ evalidate cache
    }

    return <form action={create}>...</form>
}
```

ìœ ìš©í•œ ì •ë³´: `<form action={create}>`ì€ [FormData](https://developer.mozilla.org/ko/docs/Web/API/FormData/FormData) ë°ì´í„° í˜•ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ìœ„ì˜ ì˜ˆì—ì„œ HTML ì–‘ì‹ì„ í†µí•´ ì œì¶œëœ [FormDataëŠ”](https://developer.mozilla.org/ko/docs/Web/HTML/Element/form) ì„œë²„ ì•¡ì…˜ 'create'ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ë°ì´í„° ì¬ê²€ì¦

ì„œë²„ ì•¡ì…˜ì„ ì‚¬ìš©í•˜ë©´ Next.js ìºì‹œë¥¼ í•„ìš”ì— ë”°ë¼ ë¬´íš¨í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. revalidatePathë¥¼ ì‚¬ìš©í•˜ì—¬ ì „ì²´ ë¼ìš°íŠ¸ ì„¸ê·¸ë¨¼íŠ¸ë¥¼ ë¬´íš¨í™”í•˜ê±°ë‚˜ revalidateTagë¥¼ ì‚¬ìš©í•˜ì—¬ ìºì‹œ íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • ë°ì´í„°ë¥¼ ë¬´íš¨í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```javascript
// app/actions.ts
// TypeScript

'use server'

import { revalidatePath } from 'next/cache'

export default async function submit() {
    await submitForm()
    revalidatePath('/')
}
```

ë˜ëŠ” revalidateTagë¥¼ ì‚¬ìš©í•˜ì—¬ ìºì‹œ íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • ë°ì´í„°ë¥¼ ë¬´íš¨í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```javascript
// app/actions.ts
// TypeScript

'use server'

import { revalidateTag } from 'next/cache'

export default async function submit() {
    await addPost()
    revalidateTag('posts')
}
```

## ë¦¬ë””ë ‰ì…˜

ì„œë²„ ì•¡ì…˜ ì™„ë£Œ í›„ ì‚¬ìš©ìë¥¼ ë‹¤ë¥¸ ê²½ë¡œë¡œ ë¦¬ë””ë ‰ì…˜í•˜ë ¤ë©´ [ë¦¬ë””ë ‰ì…˜](https://nextjs.org/docs/app/api-reference/functions/redirect) ë° ì ˆëŒ€ ë˜ëŠ” ìƒëŒ€ URLì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```javascript
// app/actions.ts
// TypeScript

'use server'

import { redirect } from 'next/navigation'
import { revalidateTag } from 'next/cache'

export default async function submit() {
    const id = await addPost()
    revalidateTag('posts') // ìºì‹œëœ ê²Œì‹œë¬¼ ì—…ë°ì´íŠ¸
    redirect(`/post/${id}`) // ìƒˆ ê²½ë¡œë¡œ ì´ë™
}
```

## ì–‘ì‹ ìœ íš¨ì„± ê²€ì‚¬

ê¸°ë³¸ ì–‘ì‹ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìœ„í•´ `required` ë° `type="email"`ê³¼ ê°™ì€ HTML ìœ íš¨ì„±ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.

ë” ê³ ê¸‰ ì„œë²„ ì¸¡ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ìœ„í•´ì„œëŠ” íŒŒì‹±ëœ ì–‘ì‹ ë°ì´í„°ì˜ êµ¬ì¡°ë¥¼ ìœ íš¨ì„± ê²€ì‚¬í•˜ê¸° ìœ„í•´ zodì™€ ê°™ì€ ìŠ¤í‚¤ë§ˆ ìœ íš¨ì„± ê²€ì‚¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”:

```javascript
// app/actions.ts
// TypeScript

import { z } from 'zod'

const schema = z.object({
    // ...
})

export default async function submit(formData: FormData) {
    const parsed = schema.parse({
        id: formData.get('id'),
    })
    // ...
}
```

## ë¡œë”© ìƒíƒœ í‘œì‹œ

ì„œë²„ì—ì„œ ì–‘ì‹ì´ ì œì¶œë˜ëŠ” ë™ì•ˆ ë¡œë”© ìƒíƒœë¥¼ í‘œì‹œí•˜ë ¤ë©´ `Server Action`ì„ ì‚¬ìš©í•˜ê³  ì–‘ì‹ ìš”ì†Œì˜ ìì‹ìœ¼ë¡œë§Œ `useFormStatus` í›…ì„ ì‚¬ìš©í•˜ì„¸ìš”.

ì˜ˆë¥¼ ë“¤ì–´ ë‹¤ìŒ ì œì¶œ ë²„íŠ¼:

```javascript
// app/submit-button.tsx
// TypeScript

'use client'

import { experimental_useFormStatus as useFormStatus } from 'react-dom'

export function SubmitButton() {
    const { pending } = useFormStatus()

    return (
        <button type="submit" aria-disabled={pending}>
            ì¶”ê°€
        </button>
    )
}
```

ì´ `<SubmitButton />`ì€ Server Actionì´ í¬í•¨ëœ ì–‘ì‹ê³¼ í•¨ê»˜ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```javascript
// app/page.tsx
// TypeScript

import { SubmitButton } from '@/app/submit-button'

export default async function Home() {
  return (
    <form action={...}>
      <input type="text" name="field-name" />
      <SubmitButton />
    </form>
  )
}
```

## ì˜¤ë¥˜ ì²˜ë¦¬

ì„œë²„ ì•¡ì…˜ì€ ì§ë ¬í™” ê°€ëŠ¥í•œ ê°ì²´ë¥¼ ë°˜í™˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ì„œë²„ ì•¡ì…˜ì€ ìƒˆ í•­ëª©ì„ ë§Œë“¤ ë•Œ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```javascript
// app/actions.ts
// TypeScript

'use server'

export async function createTodo(prevState: any, formData: FormData) {
    try {
        await createItem(formData.get('todo'))
        return revalidatePath('/')
    } catch (e) {
        return { message: 'ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤' }
    }
}
```

ê·¸ëŸ° ë‹¤ìŒ í´ë¼ì´ì–¸íŠ¸ êµ¬ì„± ìš”ì†Œì—ì„œ ì´ ê°’ì„ ì½ê³  ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```javascript
// app/add-form.tsx
// TypeScript

'use client'

import { experimental_useFormState as useFormState } from 'react-dom'
import { experimental_useFormStatus as useFormStatus } from 'react-dom'
import { createTodo } from '@/app/actions'

const initialState = {
  message: null,
}

function SubmitButton() {
  const { pending } = useFormStatus()

  return (
    <button type="submit" aria-disabled={pending}>
      ì¶”ê°€
    </button>
}

export function AddForm() {
  const [state, formAction] = useFormState(createTodo, initialState)

  return (
    <form action={formAction}>
      <label htmlFor="todo">ì‘ì—… ì…ë ¥</label>
      <input type="text" id="todo" name="todo" required />
      <SubmitButton />
      <p aria-live="polite" className="sr-only">
        {state?.message}
      </p>
    </form>
  )
}
```

## ë‚™ê´€ì  ì—…ë°ì´íŠ¸

ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ì§€ ì•Šê³  ì„œë²„ ì•¡ì…˜ì´ ì™„ë£Œë˜ê¸°ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ëŒ€ì‹  UIë¥¼ ë‚™ê´€ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ë ¤ë©´ `useOptimistic`ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”:

```javascript
// app/page.tsx
// TypeScript

'use client'

import { experimental_useOptimistic as useOptimistic } from 'react'
import { send } from './actions'

type Message = {
  message: string
}

export function Thread({ messages }: { messages: Message[] }) {
  const [optimisticMessages, addOptimisticMessage] = useOptimistic<Message[]>(
    messages,
    (state: Message[], newMessage: string) => [
      ...state,
      { message: newMessage },
    ]
  )

  return (
    <div>
      {optimisticMessages.map((m, k) => (
        <div key={k}>{m.message}</div>
      )}
      <form
        action={async (formData: FormData) => {
          const message = formData.get('message')
          addOptimisticMessage(message)
          await send(message)
        }}
      >
        <input type="text" name="message" />
        <button type="submit">ë³´ë‚´ê¸°</button>
      </form>
    </div>
  )
}
```

## ì¿ í‚¤ ì„¤ì •

Server Action ë‚´ì—ì„œ cookies í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ ì•¡ì…˜ ë‚´ì—ì„œ [ì¿ í‚¤](https://nextjs.org/docs/app/api-reference/functions/cookies)ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```javascript
// app/actions.ts
// TypeScript

'use server'

import { cookies } from 'next/headers'

export async function create() {
    const cart = await createCart()
    cookies().set('cartId', cart.id)
}
```

## ì¿ í‚¤ ì½ê¸°

Server Action ë‚´ì—ì„œ cookies í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ ì•¡ì…˜ ë‚´ì—ì„œ ì¿ í‚¤ë¥¼ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```javascript
// app/actions.ts
//TypeScript
'use server'

import { cookies } from 'next/headers'

export async function read() {
    const auth = cookies().get('authorization')?.value
    // ...
}
```

## ì¿ í‚¤ ì‚­ì œ

Server Action ë‚´ì—ì„œ cookies í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¿ í‚¤ë¥¼ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```javascript
// app/actions.ts
// TypeScript

'use server'

import { cookies } from 'next/headers'

export async function delete() {
  cookies().delete('name')
  // ...
}
```

ì„œë²„ ì•¡ì…˜ì—ì„œ ì¿ í‚¤ ì‚­ì œì— ëŒ€í•œ ì¶”ê°€ ì˜ˆì‹œë¥¼ í™•ì¸í•˜ë ¤ë©´ [ë” ë³´ê¸°](https://nextjs.org/docs/app/api-reference/functions/cookies#deleting-cookies)ë¥¼ ì°¸ì¡°í•˜ì‹­ì‹œì˜¤.
