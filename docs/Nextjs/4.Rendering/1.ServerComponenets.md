# Server Components (서버 컴포넌트)

React 서버 컴포넌트를 사용하면 UI를 서버에서 렌더링하고 선택적으로 캐시할 수 있습니다. Next.js에서는 렌더링 작업을 라우트 세그먼트별로 더 분할하여 스트리밍 및 부분 렌더링을 가능하게 하며 세 가지 다른 서버 렌더링 전략이 있습니다.

1. 정적 렌더링
2. 동적 렌더링
3. 스트리밍

이 페이지에서는 서버 컴포넌트의 작동 방식, 언제 사용하는지 및 서버 렌더링 전략에 대해 알아보겠습니다.

## 서버 렌더링의 이점

서버에서 렌더링 작업을 수행하는 것에는 몇 가지 이점이 있습니다.

1. 데이터 가져오기: 서버 컴포넌트를 사용하면 데이터 가져오기를 서버에 가깝게 이동시킬 수 있습니다. 이로 인해 렌더링에 필요한 데이터를 가져오는 데 걸리는 시간과 클라이언트가 수행해야 하는 요청의 양을 줄일 수 있어 성능을 향상시킬 수 있습니다.

2. 보안: 서버 컴포넌트를 사용하면 토큰 및 API 키와 같은 민감한 데이터 및 로직을 서버에 유지할 수 있으며 이를 클라이언트에 노출할 위험이 없습니다.

3. 캐싱: 서버에서 렌더링하면 결과를 캐시하고 다음 요청 및 사용자 전체에 걸쳐 재사용할 수 있습니다. 이를 통해 각 요청마다 수행되는 렌더링 및 데이터 가져오기 양을 줄여 성능을 향상시키고 비용을 절감할 수 있습니다.

4. 번들 크기: 서버 컴포넌트를 사용하면 이전에 클라이언트 JavaScript 번들 크기에 영향을 미칠 수 있는 큰 종속성을 서버에 유지할 수 있습니다. 이것은 인터넷 속도가 느린 사용자나 성능이 낮은 기기를 사용하는 사용자에게 이점이 있습니다. 클라이언트가 서버 컴포넌트를 렌더링하기 위해 JavaScript를 다운로드, 구문 분석 및 실행할 필요가 없기 때문입니다.

5. 초기 페이지 로드 및 첫 번째 컨텐츠 표시 (FCP): 서버에서는 사용자가 페이지를 즉시 볼 수 있도록 HTML을 생성하여 클라이언트가 페이지를 렌더링하는 데 필요한 JavaScript를 다운로드, 구문 분석 및 실행하는 대기 없이 페이지를 봐 줄 수 있습니다.

6. 검색 엔진 최적화 및 소셜 네트워크 공유성: 렌더링된 HTML은 검색 엔진 봇이 페이지를 색인화하고 소셜 네트워크 봇이 페이지에 대한 소셜 카드 미리보기를 생성하는 데 사용할 수 있습니다.

7. 스트리밍: 서버 컴포넌트를 사용하면 렌더링 작업을 청크로 분할하고 사용자가 전체 페이지를 서버에서 렌더링될 때까지 기다릴 필요 없이 필요한 부분을 먼저 볼 수 있도록 클라이언트로 스트리밍할 수 있습니다.

## Next.js에서 서버 컴포넌트 사용

기본적으로 Next.js는 서버 컴포넌트를 사용합니다. 이로써 별도의 구성 없이 서버 렌더링을 자동으로 구현할 수 있으며 필요한 경우 클라이언트 컴포넌트를 사용할 수 있습니다. 클라이언트 컴포넌트에 대해서는 "클라이언트 컴포넌트"를 참조하십시오.

## 서버 컴포넌트는 어떻게 렌더링되나요?

서버에서 Next.js는 렌더링을 조정하기 위해 React의 API를 사용합니다. 렌더링 작업은 다음과 같은 단계로 나누어집니다:

1. React는 서버 컴포넌트를 React 서버 컴포넌트 페이로드(RSC 페이로드)라고 하는 특별한 데이터 형식으로 렌더링합니다.
2. Next.js는 RSC 페이로드와 클라이언트 컴포넌트 JavaScript 지시사항을 사용하여 서버에서 HTML을 렌더링합니다.

그런 다음 클라이언트에서는 다음과 같은 단계로 진행됩니다:

1. HTML은 초기 페이지 로드에서 빠른 비대화식 미리보기를 표시하기 위해 사용됩니다.
2. React 서버 컴포넌트 페이로드는 클라이언트 및 서버 컴포넌트 트리를 조정하고 DOM을 업데이트하는 데 사용됩니다.
3. JavaScript 지시사항은 클라이언트 컴포넌

트를 보강하고 애플리케이션을 상호작용 가능하게 만드는 데 사용됩니다.

## React 서버 컴포넌트 페이로드 (RSC)

RSC 페이로드는 렌더링된 React 서버 컴포넌트 트리의 압축된 바이너리 표현입니다. 이것은 클라이언트에서 브라우저 DOM을 업데이트하는 데 사용되며 RSC 페이로드에는 다음 내용이 포함됩니다:

1. 서버 컴포넌트의 렌더링 결과
2. 클라이언트 컴포넌트를 렌더링할 위치 및 해당 JavaScript 파일에 대한 참조를 위한 플레이스홀더
3. 서버 컴포넌트에서 클라이언트 컴포넌트로 전달되는 어떤 프롭

## 서버 렌더링 전략

서버 렌더링에는 정적, 동적 및 스트리밍의 세 가지 하위 집합이 있습니다.

### 정적 렌더링 (기본값)

정적 렌더링에서는 라우트가 빌드 시간에 또는 데이터 재유효화 후에 렌더링됩니다. 결과는 캐시되어 콘텐츠 전달 네트워크 (CDN)로 푸시할 수 있습니다. 이 최적화를 통해 렌더링 작업의 결과를 사용자와 서버 요청 사이에서 공유할 수 있습니다.

정적 렌더링은 사용자에 맞게 개인화되지 않은 데이터를 가지고 있는 라우트에 유용하며 빌드 시간에 알 수 있는 데이터, 예를 들어 정적 블로그 게시물이나 제품 페이지와 같은 것들에 적합합니다.

### 동적 렌더링

동적 렌더링에서는 라우트가 각 사용자에 대해 요청 시간에 렌더링됩니다.

동적 렌더링은 사용자에 개인화된 데이터를 가지거나 요청 시간에만 알 수 있는 정보를 가지고 있는 라우트에 유용합니다. 이는 쿠키나 URL의 검색 매개변수와 같은 것들을 포함할 수 있습니다.

### 캐시된 데이터를 가진 동적 라우트

대부분의 웹 사이트에서 라우트는 완전히 정적이거나 완전히 동적이지 않습니다. 예를 들어, 캐시된 제품 데이터를 사용하면 일정 간격으로 유효성을 검사하고 있지만 개인화된 고객 데이터도 가질 수 있습니다.

Next.js에서는 RSC 페이로드와 데이터 캐시가 별도로 캐시됩니다. 이를 통해 요청 시간에 모든 데이터를 가져오는 성능에 대한 걱정 없이 동적 렌더링을 선택할 수 있습니다. 전체 라우트가 정적인지 동적인지 선택할 필요가 없습니다.

자세한 내용은 "풀 라우트 캐시와 데이터 캐시"를 참조하십시오.

### 동적 렌더링으로 전환

렌더링 중에 동적 함수 또는 캐시되지 않은 데이터 요청이 발견되면 Next.js는 전체 라우트를 동적 렌더링으로 전환합니다. 이 표는 동적 함수와 데이터 캐싱이 라우트가 정적으로 또는 동적으로 렌더링되는 방식에 어떤 영향을 미치는지에 대한 내용을 요약합니다.

| Dynamic Functions | Data       | Route                |
| ----------------- | ---------- | -------------------- |
| No                | Cached     | Statically Rendered  |
| Yes               | Cached     | Dynamically Rendered |
| No                | Not Cached | Dynamically Rendered |
| Yes               | Not Cached | Dynamically Rendered |

위의 표에서 모든 데이터가 캐시되어 라우트가 완전히 정적으로 되려면 모든 데이터가 캐시되어야 합니다. 그러나 캐시된 및 캐시되지 않은 데이터를 모두 가져올 수 있는 동적 렌더링 라우트를 가질 수 있습니다. 개발자로서, 정적 또는 동적 렌더링을 선택할 필요가 없으며 Next.js는 기능과 API를 기반으로 각 라우트에 대해 최상의 렌더링 전략을 자동으로 선택합니다. 대신 특정 데이터를 캐시하거나 다시 유효성을 검사할 때를 선택하고 UI 일부를 스트리밍할 수 있습니다.

## 동적 함수

동적 함수는 요청 시간에만 알 수 있는 정보, 예를 들어 사용자의 쿠키, 현재 요청 헤더 또는 URL의 검색 매개변수와 같은 정보를 기반으로 합니다. Next.js에서 이러한 동적 함수는 다음과 같습니다:

-   `cookies()` 및 `headers()`: 서버 컴포넌트에서 이러한 함수를 사용하면 전체 라우트가 요청 시간에 동적 렌더링으로 전환됩니다.
-   `useSearchParams()`: 클라이언트 컴포넌트에서 이 함수를 사용하면 정적 렌더링을 건너뛰고 가장 가까운 상위 Suspense 경계까지 클라이언트 컴포넌트를 렌더링합니다.
-   `searchParams`: 페이지 속성을 사용하면 페이지가 요청 시간에 동적 렌더링되도록 할 수 있습니다.

이러한 함수 중 하나를 사용하면 전체 라우트가 요청 시간에 동적 렌더링으로 전환됩니다.

## 스트리밍

<img src="https://nextjs.org/_next/image?url=%2Fdocs%2Fdark%2Fsequential-parallel-data-fetching.png&w=3840&q=75&dpl=dpl_7ApAXAPS9Jx2rHVsnwoDNiDWWrWe">

스트리밍을 통해 UI를 서버에서 점진적으로 렌더링할 수 있습니다. 작업은 청크로 분할되어 클라이언트로 스트리밍되며 필요한 부분이 준비되면 사용자가 페이지 일부를 먼저 볼 수 있도록 합니다. 이렇게 하면 초기 페이지 로드 성능과 페이지의 전체 내용을 렌더링하는 데 시간이 걸리는 느린 데이터 가져오기에 의존하는 UI 모두를 개선할 수 있습니다. 예를 들어 제품 페이지의 리뷰 등이 있습니다.

<img src="https://nextjs.org/_next/image?url=%2Fdocs%2Fdark%2Fserver-rendering-with-streaming.png&w=3840&q=75&dpl=dpl_7ApAXAPS9Jx2rHVsnwoDNiDWWrWe">

기본적으로 Next.js 앱 라우터에는 스트리밍이 내장되어 있습니다. 이것은 초기 페이지 로딩 성능과 더 느린 데이터 가져오기에 의존하는 UI 모두를 개선하는 데 도움이 됩니다. 자세한 내용은 "로딩 UI 및 스트리밍" 섹션을 참조하십시오.
